<?php

$MyStr=Array("ChangeUsername","UsersWebsite","UserWebsitePasswordRecovery","DeltasibServices","GeneralNoneBlockIP","BackupWebAccess","HttpLog","IPPool","UnBlockUser","ListSummary","DeleteSession","DisconnectAllUser","BlockCallerId","DisconnectUser","MyChangeLog","ChangeLog","AddPayment","ChangePassword","PortStatus","MyPayment","MyTransaction","BriefUser","www","WebUnblock","WebNewUser","WebMessage","WebHistory","WebFeedback","WebAccess","Web","VISPs","VispName","VispAccess","Visp_Id","Visp","ViewField","View","UserUsage","UserType","UserSupportHistory","UserStatus","UserService","Users","UserPayment","UserNote","UserBlock","UserAttachment","UserAndUsage","User","UsedIP","UrlList","URL","UniversalNo","TransferCredit","Transaction","TrafficRate","TotalUsage","TopSite","TimeRate","TerminalAccess","TAX","SupportItem","SupportHistory","SupporterName","Supporter_Id","Supporter","Summary","Stop","StatusTo","StatusQueue","StatusName","StatusDT","StatusCreator","CreditStatus","ChangeStatus","SetTimedStatus","Status","StartNextService","Start","SMSProvider","Shahkar","SetMaxPrepaidDebit","SetInitialMonthOff","Session","Services","ServiceName","ServiceInfo","ServiceBaseAccess","CheckService","Service","Server","SendInfoSMS","SendCustomSMS","Security","SavingOff","RetrieveAll","Restart","ResetToZero","ResellerName","ResellerAccess","ChangeReseller","Reseller","Reporting","Report","RefundMoney","RadiusUnblock","RadiusLog","Radius","Print","PrePaid","PostPaid","PostalCode","Pos","Pool","AdslPhone","Phone","Permit","PayPlan","PayOnline","PaymentType","Payment","PayBalance","GetPassword","Pass","Param","PackageAccess","Package","OwnershipType","Other","Organization","Online","OffFormula","Notify","Note","NOE","NetworkIP","NetLog","Nationality","CompanyNationalCode","NationalCode","NasInfo","NasAccess","Nas","FatherName","Name","MyCredit","Mobile","MikrotikRateValue","MikrotikRate","Message","MaxPrepaidDebit","LoginTime","IPRouteLog","Log","List","IPActivity","IP","Invoice","Installment","InitialMonthOff","IdentInfo","Info","IdentificationType","IdentificationNo","Gift","GetMoney","Gender","FinishRule","Feedback","Family","ExtraCredit","ExpirationDate","Event","EndDate","Email","EditField","Edit","ds_urlreporting","ds_notify","ds_netlog","ds_mongoose","ds_mikrotikrate","ds_disconnect","Deposit","DeleteScheduled","DeleteEntry","DeleteAll","Delete","DebitControl","DCQueue","DailyUsage","Daily","CustomerType","CRM","Credit","Copy","Connection","CompanyType","CompanyRegistryCode","CompanyRegistrationDate","CompanyEconomyCode","Commission","Comment","ClassAccess","Class","Cheque","Check","ChangeStartup","ChangeClass","CertificateNo","CenterName","CenterAccess","Center_Id","Center","Cash","Cancel","CallerIdBlock","AddCallerId","CallerId","CalledId","BirthPlace","BirthDate","Base","BankTerminal","AutoAdd","Attachment","Apply","Admin","Address","AddField","Add","ActiveDirectory");

$MyStrFa= Array("تغییر نام کاربری","پنل کاربران","بازیابی کلمه عبور در پنل کاربری","سرویس های دلتاسیب","آی پی هایی که مسدود نمی شوند","دسترسی به فایل های پشتیبانی","لاگ سازمان","دامنه آی پی","کاربر غیر مسدود","لیست خلاصه","حذف نشست","قطع اتصال همه کاربران","مک/آی پی بلاک شده","قطع اتصال کاربر","گزارش های نمایندگان فروش من-لیست تغییرات","لیست تغییرات","افزودن پرداختی","تغییر کلمه عبور","وضعیت پورت","گزارش های نمایندگان فروش من-پرداخت","گزارش های نمایندگان فروش من-تراکنش","دسترسی سریع به کاربر","پنل","رفع مسدودی پنل کاربری","ثبت نام در پنل کاربری","پیام پنل کاربری","تاریخچه پنل مدیریت","بازخورد در پنل کاربری","دسترسی های پنل کاربران","پنل","ارائه دهنده مجازی اینترنت","نام ارائه دهنده مجازی اینترنت","دسترسی ارائه دهنده مجازی اینترنت","شناسه ارائه دهنده مجازی اینترنت","ارائه دهنده مجازی اینترنت","نمایش فیلد","نمایش","مصرف کاربران","نوع کاربر","گزارش های کاربران من-پشتیبانی","گزارش های کاربران من-وضعیت","گزارش های کاربران من-سرویس","کاربران","گزارش های کاربران من-پرداخت","گزارش های کاربران من-یادداشت","مسدودی کاربر","گزارش های کاربران من-پیوست","کاربران و میزان استفاده","کاربران","آی پی استفاده شده","لیست صفحات بازدید شده","صفحات بازدید شده کاربر","تعداد جهانی","اعتبار منتقل شده","تراکنش","ضریب محاسبه ترافیک","مجموع استفاده","پربازدید","ضریب محاسبه زمان","دسترسی درگاه پرداخت","مالیات","موارد پشتیبانی","تاریخچه پشتیبانی","نام پشتیبان","شناسه پشتیبان","پشتیبان","خلاصه","ایست","وضعیت به","صف وضعیت","نام وضعیت","زمان وضعیت","ثبت کننده وضعیت","وضعیت اعتبار","تغییر وضعیت","وضعیت زمانبندی شده","وضعیت","شروع سرویس بعدی","شروع","ارائه دهنده پیام کوتاه","شاهکار","حداکثر بدهی مجاز","تخفیف اولیه","نشست","سرویس ها","نام سرویس","نوع سرویس محاسبه","دسترسی سرویس پایه","بررسی سرویس","لیست سرویس ها","سرور","ارسال پیامکی اطلاعات","ارسال  سفارشی پیامک","امنیت","پس انداز","بروزکردن همه","راه اندازی مجدد","صفر کردن","نام نماینده فروش","دسترسی نماینده فروش","تغییر نماینده","نماینده فروش","گزارش","گزارش","مبلغ برگشتی","رفع مسدودس ردیوس","گزارش ردیوس","ردیوس","چاپ","پیش پرداخت","پس پرداخت","کد پستی","کارتخوان","افزودن دامنه","ADSL تلفن","تلفن","سطوح دسترسی","روش پرداخت","پرداخت آنلاین","نوع پرداخت","پرداخت","تراز مالی","دریافت کلمه عبور","کلمه عبور","پارامتر","دسترسی بسته شارژ","بسته شارژ","نوع مالکیت","سایر","نام شرکت","آنلاین","فرمول تخفیف","اطلاع رسانی","پادداشت","موقعیت مکانی وایرلس","آی پی های نت لاگ","نت لاگ","ملیت","شناسه ملی شرکت","کد ملی","پارامترهای سرور ردیوس","دسترسی ردیوس","سرور ردیوس","نام پدر","نام","گزارش های نمایندگان فروش من-اعتبار","موبایل","تعریف سرعت میکروتیک","لیست سرعت های میکروتیک","اطلاع رسانی","حاکثر بدهی پیش پرداخت","محدودیت زمان ورود","گزارش مسیر آی پی","تاریخچه","لیست","فعالیت آی پی","آی پی","فاکتور","اقساط","قسط اول زمان ثبت پرداخت","شناسه شاهکار","اطلاعات","نوع شناسایی","شماره شناسایی","هدایا","دریافت پول","جنسیت","قانون اتمام","بازخورد","نام خانوادگی","اعتبار اضافی","تاریخ انقضا","رویداد","تاریخ خاتمه","ایمیل","ویرایش فیلد","ویرایش","گزارش صفحات بازدید شده دلتاسیب","اعلان دلتاسیب","نت لاگ","ds_mongoose","سرعت میکروتیک دلتاسیب","قطع کاربران دلتاسیب","بیعانه","حذف زمانبندی","حذف ورودی","حذف همه","حذف","کنترل بدهی کاربران","صف قطع اتصال","مصرف روزانه","امروز","نوع مشتری","مدیریت کاربران","اعتبار","کپی","اتصالات","نوع شرکت","شماره ثبت شرکت","تاریخ ثبت شرکت","شماره اقتصادی شرکت","پورسانت","توضیح","دسترسی دسته","دسته","چک","بررسی","تغییر شروع","تغییر دسته","شماره شناسنامه","نام مرکز","دسترسی مرکز","شناسه مرکز","مرکز","پول نقد","لغو","مک/آی پی بلاک شده","افزودن مک/آی پی","مک/آی پی","نام سرویس/آی پی سرور","محل تولد","تاریخ تولد","پایه","درگاه پرداخت","افزودن خودکار","پیوست","اعمال","مدیریت","آدرس","افزودن فیلد","افزودن","اکتیودایرکتوری");
try {
require_once("../../lib/DSInitialReseller.php");

DSDebug(0,"DSReseller_Permit_List_Change_ListRender.php ..............................................................................");

if($LResellerName=='') 	ExitError('نشست منقضی شده، لطفا مجدد وارد شوید');
PrintInputGetPost();


//Check Permission
$Reseller_Id=Get_Input('GET','DB','ParentId','INT',2,4294967295,0,0);
if($Reseller_Id==$LReseller_Id)	
	ExitError('شما نمیتوانید اطلاعات خود را ویرایش کرده یا نمایش دهید');
exitifnotpermit(0,"CRM.Reseller.Permit.List");
ExitIfNotPermitRowAccess("reseller",$Reseller_Id);

$act=Get_Input('GET','DB','act','ARRAY',array("list","do","LoadPasteInformation","PastePermissions"),0,0,0);

$ParentReseller_Id=DBSelectAsString("select ParentReseller_Id from Hreseller where Reseller_Id=$Reseller_Id");
DSDebug(1,"ParentReseller_Id=$ParentReseller_Id");

switch ($act){
	case 'do':
			DSDebug(1,"DSReseller_Permit_List_Change_ListRender do ******************************************");
			exitifnotpermit(0,"CRM.Reseller.Permit.Edit");
			
			$Visp_Id=Get_Input('GET','DB','Visp_Id','INT',0,4294967295,0,0);
			
			$TreeId=Get_Input('GET','DB','Id','STR',3,100,0,0);
			$State=Get_Input('GET','DB','state','INT',0,2,0,0);
			
			if($Visp_Id==0)
				$VispName='';
			else
				$VispName=DBSelectAsString("Select VispName From Hvisp Where Visp_Id='$Visp_Id'");
			DSDebug(4,"TreeId=$TreeId State=$State Visp_Id=$Visp_Id VispName=$VispName ");

			DBUpdate("set group_concat_max_len=20480");
			$ResellerPath=DBSelectAsString("Select ResellerPath From Hreseller Where Reseller_Id='$Reseller_Id'");
			$SubTreeResellerSet=DBSelectAsString("select group_concat(Reseller_Id) from Hreseller where (Reseller_Id = $Reseller_Id)or(ResellerPath like '$ResellerPath$Reseller_Id>%')");
			DSDebug(1,"ResellerPath=$ResellerPath	SubTreeResellerSet = [($SubTreeResellerSet)]");	
			
			if($State==1){//checked
				$sql= " update Hreseller_permit rp";
				$sql.=" join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id=$ParentReseller_Id) and (ParentRGP.Visp_Id=rp.Visp_Id) and (rp.PermitItem_Id=ParentRGP.PermitItem_Id) and (ParentRGP.ISPermit='Yes')";
				$sql.=" join Hpermititem pi on pi.PermitItem_Id=rp.PermitItem_Id";
				$sql.=" Set rp.ISPermit='Yes' ";
				$sql.=" Where (rp.Visp_Id=$Visp_Id) and (rp.reseller_Id=$Reseller_Id) and (concat(PermitItemName,'.') Like '$TreeId.%')";
			}
			else{//uncheck
				$sql= " update Hreseller_permit rp";
				// $sql.=" join Hreseller r on rp.Reseller_Id=r.Reseller_Id";
				// $sql.=" join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id=r.ParentReseller_Id) and (ParentRGP.Visp_Id=rp.Visp_Id) and (rp.PermitItem_Id=ParentRGP.PermitItem_Id) and (ParentRGP.ISPermit='Yes')";
				$sql.=" join Hpermititem pi on pi.PermitItem_Id=rp.PermitItem_Id";
				$sql.=" Set rp.ISPermit='No' ";
				$sql.=" Where (rp.Visp_Id=$Visp_Id) and (rp.Reseller_Id in ($SubTreeResellerSet)) and (concat(PermitItemName,'.') Like '$TreeId.%')";
				
				//Delete Session
				DBUpdate("Delete From Tonline_webreseller where Reseller_Id in ($SubTreeResellerSet)");
			}
			$ar=DBUpdate($sql);
			
			DSDebug(0,"sql=$sql		$ar rows affected");
			// if($ar==0){
				// logsecurity('HackTry',"Not Permit to change permit $TreeId for Visp_Id=[$Visp_Id] VispName=[$VispName], Your Client IP($LClientIP) and Username($LResellerName) Reported to administrator");
				// ExitError("Not Permit to change permit $TreeId for VispName=[$VispName], Your Client IP($LClientIP) and Username($LResellerName) Reported to administrator");
			// }
			
			SetGridLayout($TreeId,$Reseller_Id,$SubTreeResellerSet);//To set required grid layout depend on permissions
			
			if($VispName=='')
				logdb("Edit","Reseller",$Reseller_Id,"Permit","$TreeId Set To: $State");
			else	
				logdb("Edit","Reseller",$Reseller_Id,"Permit","$VispName-$TreeId Set To: $State");
			usleep(100000);
			echo "OK~$ar";
		break;
//----------------------------------------------------------------------------------------------------------		
	case 'list':
			DSDebug(1,"DSReseller_Permit_List_Change_ListRender list ******************************************");
			$Visp_Id=Get_Input('GET','DB','Visp_Id','INT',0,4294967295,0,0);
			$PermitArray=Array();
			$sql ="Select PermitItemName,If(rp.ISPermit='Yes','1','') As ISPermit";
			$sql.=" from Hreseller_permit rp";
			$sql.=" join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id=$ParentReseller_Id) and (ParentRGP.Visp_Id=rp.Visp_Id) and (ParentRGP.PermitItem_Id=rp.PermitItem_Id) and (ParentRGP.ISPermit='Yes')";
			$sql.=" join Hpermititem pi on pi.PermitItem_Id=rp.PermitItem_Id";
			$sql.=" Where (rp.reseller_Id=$Reseller_Id)and (rp.Visp_Id=$Visp_Id)";

			CopyTableToArray($PermitArray,$sql);
			DSDebug(5,"PermitArray=\n".DSPrintArray($PermitArray));

			header ("Content-Type:text/xml");
			echo '<?xml version="1.0" encoding="UTF-8"?>';

			echo '<tree id="0" >';
			if($Visp_Id==0){
				//CRM
				if(PrintSubNodeIfExist($PermitArray,"CRM")){
					PrintNodeOpenClose($PermitArray,"CRM.BriefUser");
					
					//User
					if(PrintSubNodeIfExist($PermitArray,"CRM.User")){
						PrintNodeOpenClose($PermitArray,"CRM.User.List");
						PrintNodeOpenClose($PermitArray,"CRM.User.UserType");
						PrintNodeOpenClose($PermitArray,"CRM.User.PortStatus");
						PrintNodeOpenClose($PermitArray,"CRM.User.Name");
						PrintNodeOpenClose($PermitArray,"CRM.User.Family");
						PrintNodeOpenClose($PermitArray,"CRM.User.NationalCode");
						PrintNodeOpenClose($PermitArray,"CRM.User.PayBalance");
						PrintNodeOpenClose($PermitArray,"CRM.User.EndDate");
						PrintNodeOpenClose($PermitArray,"CRM.User.ExpirationDate");
						PrintNodeOpenClose($PermitArray,"CRM.User.BirthDate");
						PrintNodeOpenClose($PermitArray,"CRM.User.Mobile");
						PrintNodeOpenClose($PermitArray,"CRM.User.Phone");
						PrintNodeOpenClose($PermitArray,"CRM.User.Organization");
						PrintNodeOpenClose($PermitArray,"CRM.User.Note");
						PrintNodeOpenClose($PermitArray,"CRM.User.ResellerName");
						PrintNodeOpenClose($PermitArray,"CRM.User.StatusDT");
						PrintNodeOpenClose($PermitArray,"CRM.User.StatusName");
						PrintNodeOpenClose($PermitArray,"CRM.User.StatusCreator");
						PrintNodeOpenClose($PermitArray,"CRM.User.Comment");
						PrintNodeOpenClose($PermitArray,"CRM.User.Address");
						PrintNodeOpenClose($PermitArray,"CRM.User.VispName");
						PrintNodeOpenClose($PermitArray,"CRM.User.CenterName");
						PrintNodeOpenClose($PermitArray,"CRM.User.SupporterName");
						PrintNodeOpenClose($PermitArray,"CRM.User.ServiceName");
						PrintNodeClose();
					}

					//Reseller
					if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller")){
						PrintNodeOpenClose($PermitArray,"CRM.Reseller.List");
						PrintNodeOpenClose($PermitArray,"CRM.Reseller.View");
						PrintNodeOpenClose($PermitArray,"CRM.Reseller.Add");
						PrintNodeOpenClose($PermitArray,"CRM.Reseller.Edit");
						PrintNodeOpenClose($PermitArray,"CRM.Reseller.Delete");
						PrintNodeOpenClose($PermitArray,"CRM.Reseller.ChangePassword");

						//Permit
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.Permit")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Permit.List");
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Permit.Edit");
							PrintNodeClose();
						}
						
						
						//Param
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.Param")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Param.List");
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Param.Add");
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Param.Edit");
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Param.Delete");
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.Credit")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Credit.List");
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Credit.TransferCredit");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.Payment")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Payment.List");
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Payment.AddPayment");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.Transaction")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.Transaction.List");
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.WebHistory")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.WebHistory.List");
							PrintNodeClose();
						}

						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.ChangeLog.List");
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.PackageAccess")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.PackageAccess.List");
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"CRM.Reseller.TerminalAccess")){
							PrintNodeOpenClose($PermitArray,"CRM.Reseller.TerminalAccess.List");
							PrintNodeClose();
						}

						PrintNodeClose();
					}





					//Service
					if(PrintSubNodeIfExist($PermitArray,"CRM.Service")){
						PrintNodeOpenClose($PermitArray,"CRM.Service.List");
						PrintNodeOpenClose($PermitArray,"CRM.Service.View");
						PrintNodeOpenClose($PermitArray,"CRM.Service.Add");
						PrintNodeOpenClose($PermitArray,"CRM.Service.Edit");
						PrintNodeOpenClose($PermitArray,"CRM.Service.Delete");
						PrintNodeOpenClose($PermitArray,"CRM.Service.Copy");
						PrintNodeOpenClose($PermitArray,"CRM.Service.DisconnectUser");

						//Param
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.Param")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.Param.List");
							PrintNodeOpenClose($PermitArray,"CRM.Service.Param.Add");
							PrintNodeOpenClose($PermitArray,"CRM.Service.Param.Edit");
							PrintNodeOpenClose($PermitArray,"CRM.Service.Param.Delete");
							PrintNodeClose();
						}

						//Gift
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.Gift")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.Gift.List");
							PrintNodeOpenClose($PermitArray,"CRM.Service.Gift.Add");
							PrintNodeOpenClose($PermitArray,"CRM.Service.Gift.Edit");
							PrintNodeOpenClose($PermitArray,"CRM.Service.Gift.Delete");
							PrintNodeClose();
						}
						
						//ClassAccess
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.ClassAccess")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.ClassAccess.List");
							PrintNodeOpenClose($PermitArray,"CRM.Service.ClassAccess.Edit");
							PrintNodeClose();
						}

						//ResellerAccess
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.ResellerAccess")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.ResellerAccess.List");
							PrintNodeOpenClose($PermitArray,"CRM.Service.ResellerAccess.Edit");
							PrintNodeClose();
						}
						//Visp
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.VispAccess")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.VispAccess.List");
							PrintNodeOpenClose($PermitArray,"CRM.Service.VispAccess.Edit");
							PrintNodeClose();
						}
						//ServiceBaseAccess
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.ServiceBaseAccess")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.ServiceBaseAccess.List");
							PrintNodeOpenClose($PermitArray,"CRM.Service.ServiceBaseAccess.Edit");
							PrintNodeClose();
						}
						//Users
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.Users")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.Users.List");
							PrintNodeClose();
						}
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"CRM.Service.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"CRM.Service.ChangeLog.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}


					if(PrintSubNodeIfExist($PermitArray,"CRM.UserService")){
						PrintNodeOpenClose($PermitArray,"CRM.UserService.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.UserPayment")){
						PrintNodeOpenClose($PermitArray,"CRM.UserPayment.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.UserStatus")){
						PrintNodeOpenClose($PermitArray,"CRM.UserStatus.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.UserAttachment")){
						PrintNodeOpenClose($PermitArray,"CRM.UserAttachment.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.UserNote")){
						PrintNodeOpenClose($PermitArray,"CRM.UserNote.List");
						PrintNodeClose();
					}
					if(PrintSubNodeIfExist($PermitArray,"CRM.UserSupportHistory")){
						PrintNodeOpenClose($PermitArray,"CRM.UserSupportHistory.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.MyCredit")){
						PrintNodeOpenClose($PermitArray,"CRM.MyCredit.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.MyPayment")){
						PrintNodeOpenClose($PermitArray,"CRM.MyPayment.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.MyTransaction")){
						PrintNodeOpenClose($PermitArray,"CRM.MyTransaction.List");
						PrintNodeClose();
					}	
					if(PrintSubNodeIfExist($PermitArray,"CRM.MyChangeLog")){
						PrintNodeOpenClose($PermitArray,"CRM.MyChangeLog.List");
						PrintNodeClose();
					}	
					
					if(PrintSubNodeIfExist($PermitArray,"CRM.Feedback")){
						PrintNodeOpenClose($PermitArray,"CRM.Feedback.View");
						PrintNodeOpenClose($PermitArray,"CRM.Feedback.List");
						PrintNodeOpenClose($PermitArray,"CRM.Feedback.Edit");
						PrintNodeOpenClose($PermitArray,"CRM.Feedback.Delete");
						
						if(PrintSubNodeIfExist($PermitArray,"CRM.Feedback.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"CRM.Feedback.ChangeLog.List");
							PrintNodeClose();
						}
						
						PrintNodeClose();
					}
					PrintNodeClose();
				}

				//Log 
				if(PrintSubNodeIfExist($PermitArray,"Log")){
					if(PrintSubNodeIfExist($PermitArray,"Log.Reseller")){
						if(PrintSubNodeIfExist($PermitArray,"Log.Reseller.Security")){
							PrintNodeOpenClose($PermitArray,"Log.Reseller.Security.List");
							PrintNodeClose();
						}	
						if(PrintSubNodeIfExist($PermitArray,"Log.Reseller.www")){
							PrintNodeOpenClose($PermitArray,"Log.Reseller.www.List");
							PrintNodeClose();
						}	

						PrintNodeClose();
					}

					if(PrintSubNodeIfExist($PermitArray,"Log.Radius")){
						if(PrintSubNodeIfExist($PermitArray,"Log.Radius.User")){
							PrintNodeOpenClose($PermitArray,"Log.Radius.User.List");
							PrintNodeOpenClose($PermitArray,"Log.Radius.User.BlockCallerId");
							PrintNodeClose();
						}
						PrintNodeClose();
					}

					if(PrintSubNodeIfExist($PermitArray,"Log.Server")){
						PrintNodeOpenClose($PermitArray,"Log.Server.List");
						PrintNodeClose();
					}	
					
					if(PrintSubNodeIfExist($PermitArray,"Log.Event")){
						PrintNodeOpenClose($PermitArray,"Log.Event.List");
						PrintNodeClose();
					}

					PrintNodeClose();
				}

				//Online
				if(PrintSubNodeIfExist($PermitArray,"Online")){

					//Radius
					if(PrintSubNodeIfExist($PermitArray,"Online.Radius")){
						if(PrintSubNodeIfExist($PermitArray,"Online.Radius.User")){
							PrintNodeOpenClose($PermitArray,"Online.Radius.User.List");
							PrintNodeOpenClose($PermitArray,"Online.Radius.User.DisconnectUser");
							PrintNodeOpenClose($PermitArray,"Online.Radius.User.DisconnectAllUser");
							PrintNodeOpenClose($PermitArray,"Online.Radius.User.DeleteSession");
							PrintNodeOpenClose($PermitArray,"Online.Radius.User.ListSummary");

							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Online.Radius.UserBlock")){
							PrintNodeOpenClose($PermitArray,"Online.Radius.UserBlock.List");
							PrintNodeOpenClose($PermitArray,"Online.Radius.UserBlock.UnBlockUser");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Online.Radius.DCQueue")){
							PrintNodeOpenClose($PermitArray,"Online.Radius.DCQueue.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Online.Radius.UsedIP")){
							PrintNodeOpenClose($PermitArray,"Online.Radius.UsedIP.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}
					
					
					//Web
					if(PrintSubNodeIfExist($PermitArray,"Online.Web")){
						if(PrintSubNodeIfExist($PermitArray,"Online.Web.Reseller")){
							PrintNodeOpenClose($PermitArray,"Online.Web.Reseller.List");
							PrintNodeOpenClose($PermitArray,"Online.Web.Reseller.DeleteSession");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Online.Web.User")){
							PrintNodeOpenClose($PermitArray,"Online.Web.User.List");
							PrintNodeOpenClose($PermitArray,"Online.Web.User.DeleteSession");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Online.Web.IPActivity")){
							PrintNodeOpenClose($PermitArray,"Online.Web.IPActivity.List");
							PrintNodeOpenClose($PermitArray,"Online.Web.IPActivity.DeleteEntry");
							PrintNodeClose();
						}
						PrintNodeClose();
					}

					//URL
					if(PrintSubNodeIfExist($PermitArray,"Online.URL")){
						if(PrintSubNodeIfExist($PermitArray,"Online.URL.Reporting")){
							PrintNodeOpenClose($PermitArray,"Online.URL.Reporting.List");

							PrintNodeClose();
						}
						PrintNodeClose();
					}
					
					//UserUsage
					if(PrintSubNodeIfExist($PermitArray,"Online.UserUsage")){
						PrintNodeOpenClose($PermitArray,"Online.UserUsage.List");
						PrintNodeClose();
					}
					
					PrintNodeClose();
					
				}

				//Report
				if(PrintSubNodeIfExist($PermitArray,"Report")){

					//URL
					if(PrintSubNodeIfExist($PermitArray,"Report.URL")){
						if(PrintSubNodeIfExist($PermitArray,"Report.URL.List")){
							PrintNodeOpenClose($PermitArray,"Report.URL.List.List");
							PrintNodeOpenClose($PermitArray,"Report.URL.List.List.Delete");
							PrintNodeOpenClose($PermitArray,"Report.URL.List.List.DeleteAll");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.URL.TopSite")){
							PrintNodeOpenClose($PermitArray,"Report.URL.TopSite.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.URL.Daily")){
							PrintNodeOpenClose($PermitArray,"Report.URL.Daily.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}
					//NetLog
					if(PrintSubNodeIfExist($PermitArray,"Report.NetLog")){
						if(PrintSubNodeIfExist($PermitArray,"Report.NetLog.List")){
							PrintNodeOpenClose($PermitArray,"Report.NetLog.List.List");
							PrintNodeOpenClose($PermitArray,"Report.NetLog.List.List.Delete");
							PrintNodeOpenClose($PermitArray,"Report.NetLog.List.List.DeleteAll");
							PrintNodeClose();
						}
						
						PrintNodeClose();
					}
					
					//User
					if(PrintSubNodeIfExist($PermitArray,"Report.User")){
						if(PrintSubNodeIfExist($PermitArray,"Report.User.UserAndUsage")){
							PrintNodeOpenClose($PermitArray,"Report.User.UserAndUsage.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Service")){
							PrintNodeOpenClose($PermitArray,"Report.User.Service.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Payment")){
							PrintNodeOpenClose($PermitArray,"Report.User.Payment.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.SavingOff")){
							PrintNodeOpenClose($PermitArray,"Report.User.SavingOff.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Notify")){
							PrintNodeOpenClose($PermitArray,"Report.User.Notify.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Connection")){
							PrintNodeOpenClose($PermitArray,"Report.User.Connection.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Status")){
							PrintNodeOpenClose($PermitArray,"Report.User.Status.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.StatusQueue")){
							PrintNodeOpenClose($PermitArray,"Report.User.StatusQueue.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Param")){
							PrintNodeOpenClose($PermitArray,"Report.User.Param.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.CallerId")){
							PrintNodeOpenClose($PermitArray,"Report.User.CallerId.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.TotalUsage")){
							PrintNodeOpenClose($PermitArray,"Report.User.TotalUsage.List");
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Attachment")){
							PrintNodeOpenClose($PermitArray,"Report.User.Attachment.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.Note")){
							PrintNodeOpenClose($PermitArray,"Report.User.Note.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.SupportHistory")){
							PrintNodeOpenClose($PermitArray,"Report.User.SupportHistory.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Report.User.ChangeLog.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.User.WebHistory")){
							PrintNodeOpenClose($PermitArray,"Report.User.WebHistory.List");
							PrintNodeClose();
						}
						
						PrintNodeClose();
					}
					
					
					//Reseller
					if(PrintSubNodeIfExist($PermitArray,"Report.Reseller")){
						if(PrintSubNodeIfExist($PermitArray,"Report.Reseller.Summary")){
							PrintNodeOpenClose($PermitArray,"Report.Reseller.Summary.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.Reseller.Credit")){
							PrintNodeOpenClose($PermitArray,"Report.Reseller.Credit.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.Reseller.Payment")){
							PrintNodeOpenClose($PermitArray,"Report.Reseller.Payment.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.Reseller.Transaction")){
							PrintNodeOpenClose($PermitArray,"Report.Reseller.Transaction.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.Reseller.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Report.Reseller.ChangeLog.List");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Report.Reseller.WebHistory")){
							PrintNodeOpenClose($PermitArray,"Report.Reseller.WebHistory.List");
							PrintNodeClose();
						}
						
						PrintNodeClose();
					}
					
					
					
					PrintNodeClose();
					
				}

				//Admin
				if(PrintSubNodeIfExist($PermitArray,"Admin")){


					//User
					if(PrintSubNodeIfExist($PermitArray,"Admin.User")){
					
						//Class
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.Class")){
							PrintNodeOpenClose($PermitArray,"Admin.User.Class.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.Class.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.Class.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.Class.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.Class.Delete");

							//Param
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Class.Param")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.Param.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.Param.Add");
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.Param.Edit");
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.Param.Delete");
								PrintNodeClose();
							}
						
							//ResellerAccess
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Class.ResellerAccess")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.ResellerAccess.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.ResellerAccess.Edit");
								PrintNodeClose();
							}
							//VispAccess
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Class.VispAccess")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.VispAccess.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.VispAccess.Edit");
								PrintNodeClose();
							}
						
						
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Class.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Class.ChangeLog.List");
								PrintNodeClose();
							}

							PrintNodeClose();
						}//Class

						
						//Status
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.Status")){
							PrintNodeOpenClose($PermitArray,"Admin.User.Status.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.Status.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.Status.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.Status.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.Status.Delete");
							//StatusTo
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Status.StatusTo")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.StatusTo.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.StatusTo.Edit");
								PrintNodeClose();
							}
							//ResellerAccess
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Status.ResellerAccess")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.ResellerAccess.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.ResellerAccess.Edit");
								PrintNodeClose();
							}
							//VispAccess
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Status.VispAccess")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.VispAccess.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.VispAccess.Edit");
								PrintNodeClose();
							}
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Status.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Status.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//Status
						
						//TimeRate
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.TimeRate")){
							PrintNodeOpenClose($PermitArray,"Admin.User.TimeRate.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.TimeRate.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.TimeRate.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.TimeRate.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.TimeRate.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.TimeRate.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.TimeRate.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//TimeRate
						
						//TrafficRate
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.TrafficRate")){
							PrintNodeOpenClose($PermitArray,"Admin.User.TrafficRate.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.TrafficRate.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.TrafficRate.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.TrafficRate.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.TrafficRate.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.TrafficRate.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.TrafficRate.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//TrafficRate
						
						//IPPool
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.IPPool")){
							PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Delete");
							//Pool
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.IPPool.Pool")){
								PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Pool.List");
								PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Pool.Add");
								PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Pool.Edit");
								PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.Pool.Delete");
								PrintNodeClose();
							}

							//UsedIP
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.IPPool.UsedIP")){
								PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.UsedIP.List");
								PrintNodeClose();
							}
							
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.IPPool.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.IPPool.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//IPPool
						
						//LoginTime
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.LoginTime")){
							PrintNodeOpenClose($PermitArray,"Admin.User.LoginTime.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.LoginTime.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.LoginTime.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.LoginTime.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.LoginTime.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.LoginTime.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.LoginTime.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//LoginTime


						//MikrotikRate
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.MikrotikRate")){
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRate.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRate.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRate.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRate.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRate.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.MikrotikRate.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRate.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//MikrotikRate

						//MikrotikRateValue
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.MikrotikRateValue")){
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRateValue.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRateValue.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRateValue.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRateValue.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRateValue.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.MikrotikRateValue.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.MikrotikRateValue.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//MikrotikRateValue
						
						
						
						//FinishRule
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.FinishRule")){
							PrintNodeOpenClose($PermitArray,"Admin.User.FinishRule.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.FinishRule.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.FinishRule.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.FinishRule.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.FinishRule.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.FinishRule.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.FinishRule.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//FinishRule
						

						
						//OffFormula
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.OffFormula")){
							PrintNodeOpenClose($PermitArray,"Admin.User.OffFormula.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.OffFormula.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.OffFormula.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.OffFormula.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.OffFormula.Delete");
							//OffFormula
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.OffFormula.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.OffFormula.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//OffFormula

						//ServiceInfo
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.ServiceInfo")){
							PrintNodeOpenClose($PermitArray,"Admin.User.ServiceInfo.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.ServiceInfo.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.ServiceInfo.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.ServiceInfo.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.ServiceInfo.Delete");
							//
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.ServiceInfo.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.ServiceInfo.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//ServiceInfo

						//WebAccess
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.WebAccess")){
							PrintNodeOpenClose($PermitArray,"Admin.User.WebAccess.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.WebAccess.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.WebAccess.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.WebAccess.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.WebAccess.Delete");
							//
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.WebAccess.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.WebAccess.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//WebAccess

						//DebitControl
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.DebitControl")){
							PrintNodeOpenClose($PermitArray,"Admin.User.DebitControl.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.DebitControl.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.DebitControl.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.DebitControl.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.DebitControl.Delete");
							//
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.DebitControl.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.DebitControl.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//DebitControl
						
						//SupportItem
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.SupportItem")){
							PrintNodeOpenClose($PermitArray,"Admin.User.SupportItem.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.SupportItem.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.SupportItem.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.SupportItem.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.SupportItem.Delete");
							//
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.SupportItem.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.SupportItem.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//SupportItem
						
						//Gift
						if(PrintSubNodeIfExist($PermitArray,"Admin.User.Gift")){
							PrintNodeOpenClose($PermitArray,"Admin.User.Gift.List");
							PrintNodeOpenClose($PermitArray,"Admin.User.Gift.View");
							PrintNodeOpenClose($PermitArray,"Admin.User.Gift.Add");
							PrintNodeOpenClose($PermitArray,"Admin.User.Gift.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.User.Gift.Delete");
							//
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Gift.Services")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Gift.Services.List");
								PrintNodeClose();
							}
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Gift.Users")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Gift.Users.List");
								PrintNodeClose();
							}
							
							//
							if(PrintSubNodeIfExist($PermitArray,"Admin.User.Gift.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.User.Gift.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}//Gift
						
						PrintNodeClose();
					}//User

					//Message
					if(PrintSubNodeIfExist($PermitArray,"Admin.Message")){

						//SMSProvider
						if(PrintSubNodeIfExist($PermitArray,"Admin.Message.SMSProvider")){
							PrintNodeOpenClose($PermitArray,"Admin.Message.SMSProvider.List");
							PrintNodeOpenClose($PermitArray,"Admin.Message.SMSProvider.Add");
							PrintNodeOpenClose($PermitArray,"Admin.Message.SMSProvider.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.Message.SMSProvider.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.Message.SMSProvider.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.Message.SMSProvider.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}
						//Notify
						if(PrintSubNodeIfExist($PermitArray,"Admin.Message.Notify")){
							PrintNodeOpenClose($PermitArray,"Admin.Message.Notify.List");
							PrintNodeOpenClose($PermitArray,"Admin.Message.Notify.Add");
							PrintNodeOpenClose($PermitArray,"Admin.Message.Notify.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.Message.Notify.Delete");
							//ChangeLog
							if(PrintSubNodeIfExist($PermitArray,"Admin.Message.Notify.ChangeLog")){
								PrintNodeOpenClose($PermitArray,"Admin.Message.Notify.ChangeLog.List");
								PrintNodeClose();
							}
							PrintNodeClose();
						}

					
						PrintNodeClose();
					}
					
					//NasInfo
					if(PrintSubNodeIfExist($PermitArray,"Admin.NasInfo")){
						PrintNodeOpenClose($PermitArray,"Admin.NasInfo.List");
						PrintNodeOpenClose($PermitArray,"Admin.NasInfo.View");
						PrintNodeOpenClose($PermitArray,"Admin.NasInfo.Add");
						PrintNodeOpenClose($PermitArray,"Admin.NasInfo.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.NasInfo.Delete");
						
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.NasInfo.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.NasInfo.ChangeLog.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}

					//Nas
					if(PrintSubNodeIfExist($PermitArray,"Admin.Nas")){
						PrintNodeOpenClose($PermitArray,"Admin.Nas.List");
						PrintNodeOpenClose($PermitArray,"Admin.Nas.View");
						PrintNodeOpenClose($PermitArray,"Admin.Nas.Add");
						PrintNodeOpenClose($PermitArray,"Admin.Nas.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.Nas.Delete");

						//CenterAccess
						if(PrintSubNodeIfExist($PermitArray,"Admin.Nas.CenterAccess")){
							PrintNodeOpenClose($PermitArray,"Admin.Nas.CenterAccess.List");
							PrintNodeOpenClose($PermitArray,"Admin.Nas.CenterAccess.Edit");
							PrintNodeClose();
						}
						
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Nas.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Nas.ChangeLog.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}

					//Radius
					if(PrintSubNodeIfExist($PermitArray,"Admin.Radius")){
						PrintNodeOpenClose($PermitArray,"Admin.Radius.List");
						PrintNodeOpenClose($PermitArray,"Admin.Radius.View");
						PrintNodeOpenClose($PermitArray,"Admin.Radius.Add");
						PrintNodeOpenClose($PermitArray,"Admin.Radius.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.Radius.Delete");
						PrintNodeOpenClose($PermitArray,"Admin.Radius.Apply");
						PrintNodeOpenClose($PermitArray,"Admin.Radius.Status");


						//Nas
						if(PrintSubNodeIfExist($PermitArray,"Admin.Radius.NasAccess")){
							PrintNodeOpenClose($PermitArray,"Admin.Radius.NasAccess.List");
							PrintNodeOpenClose($PermitArray,"Admin.Radius.NasAccess.Edit");
							PrintNodeClose();
						}
						
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Radius.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Radius.ChangeLog.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}
					
					//Visp
					if(PrintSubNodeIfExist($PermitArray,"Admin.VISPs")){
						PrintNodeOpenClose($PermitArray,"Admin.VISPs.List");
						PrintNodeOpenClose($PermitArray,"Admin.VISPs.View");
						PrintNodeOpenClose($PermitArray,"Admin.VISPs.Add");
						PrintNodeOpenClose($PermitArray,"Admin.VISPs.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.VISPs.Delete");

						//Param
						if(PrintSubNodeIfExist($PermitArray,"Admin.VISPs.Param")){
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.Param.List");
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.Param.Add");
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.Param.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.Param.Delete");
							PrintNodeClose();
						}
						//Commission
						if(PrintSubNodeIfExist($PermitArray,"Admin.VISPs.Commission")){
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.Commission.View");
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.Commission.Edit");
							PrintNodeClose();
						}
						
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.VISPs.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.VISPs.ChangeLog.List");
							PrintNodeClose();//Admin.Visp
						}
						PrintNodeClose();//Admin.Visp
					}

					//Supporter
					if(PrintSubNodeIfExist($PermitArray,"Admin.Supporter")){
						PrintNodeOpenClose($PermitArray,"Admin.Supporter.List");
						PrintNodeOpenClose($PermitArray,"Admin.Supporter.View");
						PrintNodeOpenClose($PermitArray,"Admin.Supporter.Add");
						PrintNodeOpenClose($PermitArray,"Admin.Supporter.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.Supporter.Delete");

						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Supporter.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Supporter.ChangeLog.List");
							PrintNodeClose();//Admin.Supporter
						}
						PrintNodeClose();//Admin.Supporter
					}

					//Center
					if(PrintSubNodeIfExist($PermitArray,"Admin.Center")){
						PrintNodeOpenClose($PermitArray,"Admin.Center.List");
						PrintNodeOpenClose($PermitArray,"Admin.Center.View");
						PrintNodeOpenClose($PermitArray,"Admin.Center.Add");
						PrintNodeOpenClose($PermitArray,"Admin.Center.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.Center.Delete");

						//Param
						if(PrintSubNodeIfExist($PermitArray,"Admin.Center.Param")){
							PrintNodeOpenClose($PermitArray,"Admin.Center.Param.List");
							PrintNodeOpenClose($PermitArray,"Admin.Center.Param.Add");
							PrintNodeOpenClose($PermitArray,"Admin.Center.Param.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.Center.Param.Delete");
							PrintNodeClose();//Admin.Center
						}
						//VispAccess
						if(PrintSubNodeIfExist($PermitArray,"Admin.Center.VispAccess")){
							PrintNodeOpenClose($PermitArray,"Admin.Center.VispAccess.List");
							PrintNodeOpenClose($PermitArray,"Admin.Center.VispAccess.Edit");
							PrintNodeClose();//Admin.Center
						}
						
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Center.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Center.ChangeLog.List");
							PrintNodeClose();//Admin.Center
						}
						PrintNodeClose();//Admin.Center
					}

					//Server
					if(PrintSubNodeIfExist($PermitArray,"Admin.Server")){
						PrintNodeOpenClose($PermitArray,"Admin.Server.List");

						//Param
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.Param")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.Param.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.Param.List");
							PrintNodeOpenClose($PermitArray,"Admin.Server.Param.Add");
							PrintNodeOpenClose($PermitArray,"Admin.Server.Param.Edit");
							PrintNodeOpenClose($PermitArray,"Admin.Server.Param.Delete");
							PrintNodeClose();
						}
						//HttpLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.HttpLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.HttpLog.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.HttpLog.Edit");
							PrintNodeClose();
						}
				/* 		//Admin
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.Admin")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.Admin.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.Admin.Edit");
							PrintNodeClose();
						} */
						//BackupWebAccess
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.BackupWebAccess")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.BackupWebAccess.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.BackupWebAccess.Edit");
							PrintNodeClose();
						}
						//WebNewUser
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.WebNewUser")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.WebNewUser.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.WebNewUser.Edit");
							PrintNodeClose();
						}
						//WebFeedback
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.WebFeedback")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.WebFeedback.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.WebFeedback.Edit");
							PrintNodeClose();
						}
						//GeneralNoneBlockIP
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.GeneralNoneBlockIP")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.GeneralNoneBlockIP.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.GeneralNoneBlockIP.Edit");
							PrintNodeClose();
						}
						
						//DeltasibServices
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.View");
							//wwwfinish
							if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices.wwwfinish")){
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.View");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.Apply");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.Stop");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.Start");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.Restart");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.Status");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.wwwfinish.SetAutoStart");
								PrintNodeClose();
							}
							//mikrotikrate
							if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices.mikrotikrate")){
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.mikrotikrate.Stop");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.mikrotikrate.Start");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.mikrotikrate.Restart");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.mikrotikrate.Status");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.mikrotikrate.SetAutoStart");
								PrintNodeClose();
							}
							//urlreporting
							if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices.urlreporting")){
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.urlreporting.Stop");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.urlreporting.Start");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.urlreporting.Restart");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.urlreporting.Status");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.urlreporting.SetAutoStart");
								PrintNodeClose();
							}
							//disconnect
							if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices.disconnect")){
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.disconnect.Stop");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.disconnect.Start");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.disconnect.Restart");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.disconnect.Status");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.disconnect.SetAutoStart");
								PrintNodeClose();
							}
							//notify
							if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices.notify")){
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.notify.Stop");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.notify.Start");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.notify.Restart");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.notify.Status");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.notify.SetAutoStart");
								PrintNodeClose();
							}
							//netlog
							if(PrintSubNodeIfExist($PermitArray,"Admin.Server.DeltasibServices.netlog")){
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.netlog.Stop");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.netlog.Start");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.netlog.Restart");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.netlog.Status");
								PrintNodeOpenClose($PermitArray,"Admin.Server.DeltasibServices.netlog.SetAutoStart");
								PrintNodeClose();
							}
							PrintNodeClose();
						}
						//UserWebsitePasswordRecovery
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.UserWebsitePasswordRecovery")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.UserWebsitePasswordRecovery.View");
							PrintNodeOpenClose($PermitArray,"Admin.Server.UserWebsitePasswordRecovery.Edit");
							PrintNodeClose();
						}
						
						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Server.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Server.ChangeLog.List");
							PrintNodeClose();
						}
					
						PrintNodeClose();
					}

					//BankTerminal
					if(PrintSubNodeIfExist($PermitArray,"Admin.BankTerminal")){
						PrintNodeOpenClose($PermitArray,"Admin.BankTerminal.List");
						PrintNodeOpenClose($PermitArray,"Admin.BankTerminal.View");
						PrintNodeOpenClose($PermitArray,"Admin.BankTerminal.Add");
						PrintNodeOpenClose($PermitArray,"Admin.BankTerminal.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.BankTerminal.Delete");

						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.BankTerminal.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.BankTerminal.ChangeLog.List");
							PrintNodeClose();//Admin.BankTerminal
						}
						PrintNodeClose();//Admin.BankTerminal
					}
					
					//Package
					if(PrintSubNodeIfExist($PermitArray,"Admin.Package")){
						PrintNodeOpenClose($PermitArray,"Admin.Package.List");
						PrintNodeOpenClose($PermitArray,"Admin.Package.View");
						PrintNodeOpenClose($PermitArray,"Admin.Package.Add");
						PrintNodeOpenClose($PermitArray,"Admin.Package.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.Package.Delete");

						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.Package.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.Package.ChangeLog.List");
							PrintNodeClose();//Admin.Package
						}
						PrintNodeClose();//Admin.Package
					}
					
					//PayOnline
					if(PrintSubNodeIfExist($PermitArray,"Admin.PayOnline")){
						PrintNodeOpenClose($PermitArray,"Admin.PayOnline.List");
						PrintNodeOpenClose($PermitArray,"Admin.PayOnline.View");
						PrintNodeClose();//Admin.BankTerminal
					}

					//ActiveDirectory
					if(PrintSubNodeIfExist($PermitArray,"Admin.ActiveDirectory")){
						PrintNodeOpenClose($PermitArray,"Admin.ActiveDirectory.List");
						PrintNodeOpenClose($PermitArray,"Admin.ActiveDirectory.View");
						PrintNodeOpenClose($PermitArray,"Admin.ActiveDirectory.Add");
						PrintNodeOpenClose($PermitArray,"Admin.ActiveDirectory.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.ActiveDirectory.Delete");

						//ChangeLog
						if(PrintSubNodeIfExist($PermitArray,"Admin.ActiveDirectory.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.ActiveDirectory.ChangeLog.List");
							PrintNodeClose();//Admin.BankTerminal
						}
						PrintNodeClose();//Admin.ActiveDirectory
					}

					//CalledId
					if(PrintSubNodeIfExist($PermitArray,"Admin.CalledId")){
						PrintNodeOpenClose($PermitArray,"Admin.CalledId.List");
						PrintNodeOpenClose($PermitArray,"Admin.CalledId.View");
						PrintNodeOpenClose($PermitArray,"Admin.CalledId.Add");
						PrintNodeOpenClose($PermitArray,"Admin.CalledId.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.CalledId.Delete");
						//
						if(PrintSubNodeIfExist($PermitArray,"Admin.CalledId.ChangeLog")){
							PrintNodeOpenClose($PermitArray,"Admin.CalledId.ChangeLog.List");
							PrintNodeClose();
						}
						PrintNodeClose();
					}//CalledId
					
					//CallerIdBlock
					if(PrintSubNodeIfExist($PermitArray,"Admin.CallerIdBlock")){
						PrintNodeOpenClose($PermitArray,"Admin.CallerIdBlock.List");
						PrintNodeOpenClose($PermitArray,"Admin.CallerIdBlock.Add");
						PrintNodeOpenClose($PermitArray,"Admin.CallerIdBlock.Delete");
						PrintNodeClose();
					}//CallerIdBlock
					
					//NetLogIP
					if(PrintSubNodeIfExist($PermitArray,"Admin.NetworkIP")){
						PrintNodeOpenClose($PermitArray,"Admin.NetworkIP.List");
						PrintNodeOpenClose($PermitArray,"Admin.NetworkIP.View");
						PrintNodeOpenClose($PermitArray,"Admin.NetworkIP.Add");
						PrintNodeOpenClose($PermitArray,"Admin.NetworkIP.Edit");
						PrintNodeOpenClose($PermitArray,"Admin.NetworkIP.Delete");
						PrintNodeOpenClose($PermitArray,"Admin.NetworkIP.ChangeLog.List");
						PrintNodeClose();
					}//NetworkIP */
					
					PrintNodeClose();//Admin
				}

			}
			else{// ($Visp_Id!=0)
				if(PrintSubNodeIfExist($PermitArray,"Visp.User")){
					PrintNodeOpenClose($PermitArray,"Visp.User.List"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.View"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.Edit");
					PrintNodeOpenClose($PermitArray,"Visp.User.Add"); 
					
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Info")){
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Info.AddField")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Pass");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.AdslPhone");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.NOE");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.IdentInfo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.IPRouteLog");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Email");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Comment");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Organization");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CompanyRegistryCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CompanyEconomyCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CompanyNationalCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Name");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Family");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.FatherName");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Nationality");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Mobile");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.NationalCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.BirthDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Phone");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Address");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.ExpirationDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.Gender");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CertificateNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.PostalCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.OwnershipType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CustomerType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CompanyType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.IdentificationType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.IdentificationNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.CompanyRegistrationDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.UniversalNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.AddField.BirthPlace");
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Info.ViewField")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.InitialMonthOff");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.MaxPrepaidDebit");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Visp_Id"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Center_Id");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Supporter_Id");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.AdslPhone"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.NOE"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.IdentInfo"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.IPRouteLog"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Email"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Comment"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Organization");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CompanyRegistryCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CompanyEconomyCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CompanyNationalCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Name"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Family"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.FatherName"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Nationality"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Mobile"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.NationalCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.BirthDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Phone"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Address");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.ExpirationDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.Gender");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CertificateNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.PostalCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.OwnershipType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CustomerType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CompanyType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.IdentificationType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.IdentificationNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.CompanyRegistrationDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.UniversalNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.ViewField.BirthPlace");							
							PrintNodeClose();
						}
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Info.EditField")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Visp_Id"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Center_Id");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Supporter_Id");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.AdslPhone"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.NOE"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.IdentInfo"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.IPRouteLog"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Email"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Comment"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Organization");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CompanyRegistryCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CompanyEconomyCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CompanyNationalCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Name"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Family"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.FatherName"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Nationality"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Mobile"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.NationalCode"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.BirthDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Phone"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Address");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.ExpirationDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.Gender");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CertificateNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.PostalCode");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.OwnershipType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CustomerType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CompanyType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.IdentificationType");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.IdentificationNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.CompanyRegistrationDate");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.UniversalNo");
							PrintNodeOpenClose($PermitArray,"Visp.User.Info.EditField.BirthPlace");							
							PrintNodeClose();
						}
						PrintNodeClose();
					}	

					PrintNodeOpenClose($PermitArray,"Visp.User.Delete"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.WebUnblock"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.RadiusUnblock");
					PrintNodeOpenClose($PermitArray,"Visp.User.ChangePassword"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.GetPassword"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.UsersWebsite"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.Shahkar"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.ChangeUsername"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.ChangeReseller"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.SetInitialMonthOff"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.SetMaxPrepaidDebit"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.SendInfoSMS"); 
					PrintNodeOpenClose($PermitArray,"Visp.User.SendCustomSMS"); 

					//RadiusLog
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.RadiusLog")){
						PrintNodeOpenClose($PermitArray,"Visp.User.RadiusLog.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.RadiusLog.AddCallerId"); 
						PrintNodeClose();
					}	

					//CreditStatus
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.CreditStatus")){
						PrintNodeOpenClose($PermitArray,"Visp.User.CreditStatus.List"); 
						PrintNodeClose();
					}	
					
					//Status
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Status")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Status.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Status.ChangeStatus"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Status.SetTimedStatus"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Status.DeleteScheduled"); 
						PrintNodeClose();
					}	

					//Class
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Class")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Class.List"); 
						PrintNodeClose();
					}	

					//CallerId
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.CallerId")){
						PrintNodeOpenClose($PermitArray,"Visp.User.CallerId.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.CallerId.Add"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.CallerId.Edit"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.CallerId.Delete"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.CallerId.AutoAdd"); 
						PrintNodeClose();
					}	

					//Param
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Param")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Param.List");
						PrintNodeOpenClose($PermitArray,"Visp.User.Param.Add");
						PrintNodeOpenClose($PermitArray,"Visp.User.Param.Edit");
						PrintNodeOpenClose($PermitArray,"Visp.User.Param.RetrieveAll");
						PrintNodeOpenClose($PermitArray,"Visp.User.Param.Delete");
						PrintNodeClose();
					}

					//Connection
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Connection")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Connection.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Connection.AddCallerId"); 
						PrintNodeClose();
					}	

					//Session
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Session")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Session.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Session.DeleteSession"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Session.DisconnectUser"); 
						PrintNodeClose();
					}
					
					//DailyUsage
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.DailyUsage")){
						PrintNodeOpenClose($PermitArray,"Visp.User.DailyUsage.List"); 
						PrintNodeClose();
					}	

					//Notify
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Notify")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Notify.List"); 
						PrintNodeClose();
					}
					
					//WebHistory
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.WebHistory")){
						PrintNodeOpenClose($PermitArray,"Visp.User.WebHistory.List"); 
						PrintNodeClose();
					}
					
					//Service
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Service")){
						
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Service.Base")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Base.List"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Base.Add"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Base.Cancel"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Base.CheckService"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Base.StartNextService"); 
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Service.ExtraCredit")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.ExtraCredit.List"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.ExtraCredit.Add"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.ExtraCredit.Cancel"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.ExtraCredit.ResetToZero"); 
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Service.IP")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.IP.List"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.IP.Add"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.IP.Cancel"); 
							PrintNodeClose();
						}
						
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Service.Other")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Other.List"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Other.Add"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Service.Other.Cancel"); 
							PrintNodeClose();
						}	
					
						PrintNodeClose();
					}	

					//Gift
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Gift")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Gift.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Gift.Start"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Gift.Cancel"); 
						PrintNodeClose();
					}
					
					//Installment
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Installment")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Installment.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Installment.Cancel"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Installment.Apply"); 
						PrintNodeClose();
					}
					
					//Payment
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Payment")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Payment.List"); 
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Payment.Add")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.Add.GetMoney"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.Add.RefundMoney"); 
							PrintNodeClose();
						}	

						if(PrintSubNodeIfExist($PermitArray,"Visp.User.Payment.PaymentType")){
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.PaymentType.Cash"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.PaymentType.Cheque"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.PaymentType.Pos"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.PaymentType.Deposit"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.PaymentType.TAX"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.Payment.PaymentType.Other"); 
							PrintNodeClose();
						}
						
						PrintNodeClose();
					}	
					
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.PayPlan")){
						PrintNodeOpenClose($PermitArray,"Visp.User.PayPlan.PrePaid"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.PayPlan.PostPaid"); 
						PrintNodeClose();
					}

					//PayOnline
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.PayOnline")){
						PrintNodeOpenClose($PermitArray,"Visp.User.PayOnline.List");
						PrintNodeClose();
					}
					
					//Invoice
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Invoice")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Invoice.List");
						PrintNodeOpenClose($PermitArray,"Visp.User.Invoice.Add");
						PrintNodeOpenClose($PermitArray,"Visp.User.Invoice.View");
						PrintNodeOpenClose($PermitArray,"Visp.User.Invoice.Edit");
						PrintNodeOpenClose($PermitArray,"Visp.User.Invoice.Delete");
						PrintNodeOpenClose($PermitArray,"Visp.User.Invoice.Print");					
						PrintNodeClose();
					}
					
					//SavingOff
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.SavingOff")){
						PrintNodeOpenClose($PermitArray,"Visp.User.SavingOff.List");
						PrintNodeOpenClose($PermitArray,"Visp.User.SavingOff.Cancel");
						PrintNodeClose();
					}
					
					//Attachment
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Attachment")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Attachment.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Attachment.View"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Attachment.Add"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Attachment.Edit"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Attachment.Delete"); 
						PrintNodeClose();
					}	
					
					//URL
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.URL")){
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.URL.UrlList")){
							PrintNodeOpenClose($PermitArray,"Visp.User.URL.UrlList.List"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.URL.UrlList.Delete"); 
							PrintNodeOpenClose($PermitArray,"Visp.User.URL.UrlList.DeleteAll"); 
							PrintNodeClose();
						}	
						if(PrintSubNodeIfExist($PermitArray,"Visp.User.URL.TopSite")){
							PrintNodeOpenClose($PermitArray,"Visp.User.URL.TopSite.List"); 
							PrintNodeClose();
						}	
						PrintNodeClose();
					}
					
					//Note
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.Note")){
						PrintNodeOpenClose($PermitArray,"Visp.User.Note.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Note.Add"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.Note.Delete"); 
						PrintNodeClose();
					}	
					
					//SupportHistory
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.SupportHistory")){
						PrintNodeOpenClose($PermitArray,"Visp.User.SupportHistory.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.SupportHistory.Add"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.SupportHistory.Delete"); 
						PrintNodeClose();
					}	
					
					//WebMessage
					if(PrintSubNodeIfExist($PermitArray,"Visp.User.WebMessage")){
						PrintNodeOpenClose($PermitArray,"Visp.User.WebMessage.List"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.WebMessage.Add"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.WebMessage.View"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.WebMessage.Edit"); 
						PrintNodeOpenClose($PermitArray,"Visp.User.WebMessage.Delete"); 
						PrintNodeClose();
					}	

					if(PrintSubNodeIfExist($PermitArray,"Visp.User.ChangeLog")){
						PrintNodeOpenClose($PermitArray,"Visp.User.ChangeLog.List"); 
						PrintNodeClose();
					}
					
					PrintNodeClose();
				}
			}//end of($Visp_Id!=0){

			echo "</tree>";
		break;
//----------------------------------------------------------------------------------------------------------		
	case "LoadPasteInformation":
			DSDebug(1,"DSReseller_Permit_List_Change_ListRender -> LoadPasteInformation..............................................................................");		
			exitifnotpermit(0,"CRM.Reseller.Permit.Edit");
			$Reseller_Id=Get_Input('GET','DB','ParentId','INT',2,4294967295,0,0);
			if($Reseller_Id==$LReseller_Id)	
				ExitError('نمیتوانید به سطوح دسترسی خودتان جایگذاری کنید');
			ExitIfNotPermitRowAccess("reseller",$Reseller_Id);
			
			$From_Visp_Id=Get_Input('POST','DB','From_Visp_Id','INT',1,4294967295,0,0);
			$To_Visp_Id=Get_Input('POST','DB','To_Visp_Id','INT',1,4294967295,0,0);
			
			if($From_Visp_Id==$To_Visp_Id)
				ExitError("سطوح دسترسی را به خودتان نمیتوان جایگذاری کرد");
			
			DBUpdate("set group_concat_max_len=20480");
			
			$ResellerPath=DBSelectAsString("Select ResellerPath From Hreseller Where Reseller_Id='$Reseller_Id'");
			$ChildResellerSet=DBSelectAsString("select group_concat(Reseller_Id separator \"','\") from Hreseller where (ResellerPath like '$ResellerPath$Reseller_Id>%')");
			DSDebug(1,"ResellerPath=$ResellerPath	ChildResellerSet = [('$ChildResellerSet')]");
			
			
			$sql="Create TEMPORARY TABLE PermissionFromTemp as Select rp.PermitItem_Id,rp.ISPermit from Hreseller_permit rp ".
			"join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id='$ParentReseller_Id') and (ParentRGP.Visp_Id=rp.Visp_Id) and (rp.PermitItem_Id=ParentRGP.PermitItem_Id) and (ParentRGP.ISPermit='Yes') ".
			"where rp.Reseller_Id='$Reseller_Id' and rp.Visp_Id='$From_Visp_Id'";
			$ar=DBUpdate($sql);
			DSDebug(0,"$ar row affected");
			
			$sql="Create TEMPORARY TABLE PermissionToTemp as Select rp.PermitItem_Id,rp.ISPermit from Hreseller_permit rp ".
			"join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id='$ParentReseller_Id') and (ParentRGP.Visp_Id=rp.Visp_Id) and (rp.PermitItem_Id=ParentRGP.PermitItem_Id) and (ParentRGP.ISPermit='Yes') ".
			"where rp.Reseller_Id='$Reseller_Id' and rp.Visp_Id='$To_Visp_Id'";
			$ar=DBUpdate($sql);
			DSDebug(0,"$ar row affected");
			
			$sql="Select Count(1) from PermissionFromTemp PFT join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id";
			$mr1=DBSelectAsString($sql);

			$sql="Select Count(1) from PermissionFromTemp PFT left join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id where PTT.PermitItem_Id is null";
			$mr2=DBSelectAsString($sql);

			$sql="Select Count(1) from PermissionFromTemp PFT right join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id where PFT.PermitItem_Id is null";
			$mr3=DBSelectAsString($sql);

			
			
			$sql="select count(1) from PermissionFromTemp PFT join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id where PFT.ISPermit='Yes'";
			$mr4=DBSelectAsString($sql);
			
			$sql="select count(1) from PermissionFromTemp PFT right join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id ".
				"where (PFT.ISPermit='No' or PFT.ISPermit is null)";
			$mr5=DBSelectAsString($sql);
			
			$sql="select count(1) from PermissionFromTemp PFT right join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id join ".
				"Hreseller_permit rp on rp.PermitItem_Id=PTT.PermitItem_Id and rp.Visp_Id='$To_Visp_Id' ".
				"where (rp.Reseller_Id in ('$ChildResellerSet')) and (PFT.ISPermit='No' or PFT.ISPermit is null)";
			$mr6=DBSelectAsString($sql);
			
			DBUpdate("DROP TEMPORARY TABLE PermissionFromTemp");
			DBUpdate("DROP TEMPORARY TABLE PermissionToTemp");
			echo "OK~$mr1~$mr2~$mr3~$mr4~$mr5~$mr6";
		break;
//----------------------------------------------------------------------------------------------------------		
	case "PastePermissions":
			DSDebug(1,"DSReseller_Permit_List_Change_ListRender -> PastePermissions..............................................................................");
			
			exitifnotpermit(0,"CRM.Reseller.Permit.Edit");
			$Reseller_Id=Get_Input('GET','DB','ParentId','INT',2,4294967295,0,0);
			if($Reseller_Id==$LReseller_Id)	
				ExitError('نمیتوانید به سطوح دسترسی خودتان جایگذاری کنید');
			ExitIfNotPermitRowAccess("reseller",$Reseller_Id);
			
			$From_Visp_Id=Get_Input('POST','DB','From_Visp_Id','INT',1,4294967295,0,0);
			$To_Visp_Id=Get_Input('POST','DB','To_Visp_Id','INT',1,4294967295,0,0);
			
			if($From_Visp_Id==$To_Visp_Id)
				ExitError("سطوح دسترسی را به خودتان نمیتوان جایگذاری کرد");
			
			DBUpdate("set group_concat_max_len=20480");
			
			$ResellerPath=DBSelectAsString("Select ResellerPath From Hreseller Where Reseller_Id='$Reseller_Id'");
			$ChildResellerSet=DBSelectAsString("select group_concat(Reseller_Id separator \"','\") from Hreseller where (ResellerPath like '$ResellerPath$Reseller_Id>%')");
			DSDebug(1,"ResellerPath=$ResellerPath	ChildResellerSet = [('$ChildResellerSet')]");
			
			
			$sql="Create TEMPORARY TABLE PermissionFromTemp as Select rp.PermitItem_Id,rp.Visp_Id,rp.ISPermit from Hreseller_permit rp ".
			"join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id='$ParentReseller_Id') and (ParentRGP.Visp_Id=rp.Visp_Id) and (rp.PermitItem_Id=ParentRGP.PermitItem_Id) and (ParentRGP.ISPermit='Yes') ".
			"where rp.Reseller_Id='$Reseller_Id' and rp.Visp_Id='$From_Visp_Id'";
			$ar=DBUpdate($sql);
			DSDebug(0,"$ar row affected");
			
			$sql="Create TEMPORARY TABLE PermissionToTemp as Select rp.PermitItem_Id,rp.Visp_Id,rp.ISPermit from Hreseller_permit rp ".
			"join Hreseller_permit ParentRGP on (ParentRGP.Reseller_Id='$ParentReseller_Id') and (ParentRGP.Visp_Id=rp.Visp_Id) and (rp.PermitItem_Id=ParentRGP.PermitItem_Id) and (ParentRGP.ISPermit='Yes') ".
			"where rp.Reseller_Id='$Reseller_Id' and rp.Visp_Id='$To_Visp_Id'";
			$ar=DBUpdate($sql);
			DSDebug(0,"$ar row affected");

			$sql="update PermissionFromTemp PFT left join PermissionToTemp PTT on PFT.PermitItem_Id=PTT.PermitItem_Id set PFT.ISPermit='No' where PTT.PermitItem_Id is null";
			$ar=DBUpdate($sql);
			DSDebug(0,"$ar row affected");

			$sql="update Hreseller_permit rp join PermissionFromTemp PFT on rp.PermitItem_Id=PFT.PermitItem_Id ".
			"set rp.ISPermit='Yes' ".
			"where (rp.Reseller_Id='$Reseller_Id') and (rp.Visp_Id=$To_Visp_Id) and (PFT.ISPermit='Yes')";
			$ar1=DBUpdate($sql);
			DSDebug(0,"$ar1 rows affected");

			$sql="update Hreseller_permit rp left join PermissionFromTemp PFT on rp.PermitItem_Id=PFT.PermitItem_Id ".
			"set rp.ISPermit='No' ".
			"where (rp.Reseller_Id='$Reseller_Id') and (rp.Visp_Id=$To_Visp_Id) and (PFT.ISPermit='No' or PFT.ISPermit is null)";
			$ar2=DBUpdate($sql);
			DSDebug(0,"$ar2 rows affected");
			
			$sql="update Hreseller_permit rp left join PermissionFromTemp PFT on rp.PermitItem_Id=PFT.PermitItem_Id ".
			"set rp.ISPermit='No' ".
			"where (rp.Reseller_Id in ('$ChildResellerSet')) and (rp.Visp_Id=$To_Visp_Id) and (PFT.ISPermit='No' or PFT.ISPermit is null)";
			$ar3=DBUpdate($sql);
			DSDebug(0,"$ar3 row affected");
			DBUpdate("DROP TEMPORARY TABLE PermissionFromTemp");
			DBUpdate("DROP TEMPORARY TABLE PermissionToTemp");
			echo "OK~";
		break;
	default :
		echo "~Unknown Request";
}
}
catch (Exception $e) {
	ExitError($e->getMessage());
}
//=================================
function PrintNodeOpenClose($PermitArray,$PermitItemName){
	global $MyStr,$MyStrFa;
	$Key= multidimensional_search($PermitArray, $PermitItemName);
	// DSDebug(5,"PermitItemName$PermitItemName");
	if($Key!==false){
		// DSDebug(4,"PermitItemName=$PermitItemName Found Key=$Key Permit=".$PermitArray[$Key]['ISPermit']);
		$LastSegment=str_replace($MyStr,$MyStrFa,end(explode('.', $PermitItemName)));
		$filename='Line';
		echo "<item text='$LastSegment' id='$PermitItemName' checked='".$PermitArray[$Key]['ISPermit']."'	im0='DSTree{$filename}0.png' im1='DSTree{$filename}1.png' im2='DSTree{$filename}2.png'></item>";
	}	
}
function PrintNodeOpenForce($PermitItemName){
	global $MyStr,$MyStrFa;
	$LastSegment=str_replace($MyStr,$MyStrFa,end(explode('.', $PermitItemName)));
	//$filename=str_replace(".", "",$PermitItemName);
	$filename='Line';
	echo "<item text='$LastSegment' id='$PermitItemName' checked='' im0='DSTree{$filename}0.png' im1='DSTree{$filename}1.png' im2='DSTree{$filename}2.png'>";
}


function PrintNodeClose(){
	echo "</item>";
}

function PrintSubNodeIfExist($Arr,$PartialPermitItemName){
	DSDebug(4,"PartialPermitItemName=$PartialPermitItemName");
	if(multidimensional_search_StartWith($Arr, "$PartialPermitItemName.")!==false){
		PrintNodeOpenForce($PartialPermitItemName);
		return true;
	}
	else 
		return false;
}
function multidimensional_search($parents, $searched){
	if (empty($searched) || empty($parents))
		return false;
	
	foreach ($parents as $key => $value) {
		// DSDebug(0,"key=$key      value=$value");	  
		if(IsSet($parents[$key]["PermitItemName"]) && $parents[$key]["PermitItemName"] == $searched)
			return $key; 
	} 
	return false; 
}

function multidimensional_search_StartWith($parents, $searched){
	if (empty($searched) || empty($parents))
		return false; 
  
	foreach ($parents as $key => $value){
		// DSDebug(0,"key=$key      value=$value");
		if(IsSet($parents[$key]["PermitItemName"]) && (strpos($parents[$key]["PermitItemName"],$searched)===0))
			return $key;
	} 
	return false; 
}


function SetGridLayout($TreeId,$Reseller_Id,$SubTreeResellerSet){
	DSDebug(1,"In function SetGridLayout for TreeId=$TreeId	Reseller_Id=$Reseller_Id	SubTreeResellerSet=$SubTreeResellerSet");
	if(($TreeId=="CRM")||(strpos($TreeId,"CRM.User")===0)){
		$sql="Select ISPermit from Hreseller_permit rp join Hpermititem pi on PermitItemName='CRM.User.List' and rp.PermitItem_Id=pi.PermitItem_Id ".
		" where rp.Reseller_Id=$Reseller_Id and rp.Visp_Id=0";
		$ISPermit_CRM_User_List=DBSelectAsString($sql);
		if($ISPermit_CRM_User_List=="Yes"){
			$sql="Insert Ignore Hgrid_layout Set ".
				"Reseller_Id='$Reseller_Id',".
				"ItemName='CRMUser',".
				"ColIds='u.User_Id,u.Username',".
				"ColHeaders='{#stat_count} rows,Username',".
				"ColInitWidths='80,100',".
				"RenderColumnIds='User_Id,Username'";
			DBInsert($sql);
			$ResellerArray=explode(",",$SubTreeResellerSet);
			foreach($ResellerArray as $RId)
				SetCRMUserGridLayout($RId);
		}
		else{
			$n=DBDelete("Delete from Hgrid_layout where ItemName='CRMUser' and Reseller_Id in ($SubTreeResellerSet)");
			DSDebug(1,"'CRMUser' grid layout of $n reseller deleted");
		}
	}
	elseif(($TreeId=="Online")||($TreeId=="Online.Radius")||($TreeId=="Online.Radius.User")||($TreeId=="Online.Radius.User.List")){
		$sql="Select ISPermit from Hreseller_permit rp join Hpermititem pi on PermitItemName='Online.Radius.User.List' and rp.PermitItem_Id=pi.PermitItem_Id ".
		" where rp.Reseller_Id=$Reseller_Id and rp.Visp_Id=0";
		$ISPermit_Online_Radius_User_List=DBSelectAsString($sql);
		if($ISPermit_Online_Radius_User_List=="Yes"){
			$sql="Insert Ignore Hgrid_layout Set ".
			"Reseller_Id='$Reseller_Id',".
			"ItemName='OnlineRadiusUser',".
			"ColIds='Online_RadiusUser_Id,oru.RUsername,LastDownloadSpeed,LastUploadSpeed,ServiceInfoName,oru.ServiceRate,VispName,NasName,CenterName,Name,Family,ISFinishUser,CallingStationId,CalledStationId,FramedIpAddress,NasIpAddress,SRCNasIpAddress,AcctStartTime,DTRequest,AcctSessionTime,SendTr,ReceiveTr,NasPortId,NasPortType,ServiceType,FramedProtocol,URLReporting,oru.InterimTime,InterimCount,TerminateCause,ReturnTr,InternetUse,IntranetUse,MessengerUse,FreeUse,SpecialUse',".
			"ColHeaders='{#stat_count} rows,RUsername,DownloadSpeed(Kb/s),UploadSpeed(Kb/s),ServiceInfoName,ServiceRate,VispName,NasName,CenterName,Name,Family,ISFinishUser,CallingId,CalledId,FramedIP,NasIP,SRCNasIP,StartTime,LastUpdate,SessionTime(s),SendTr(B),ReceiveTr(B),NasPortId,NasPortType,ServiceType,FramedProtocol,URLReporting,InterimTime,InterimCount,TerminateCause,ReturnTr,InternetUse,IntranetUse,MessengerUse,FreeUse,SpecialUse',".
			"ColInitWidths='80,80,125,115,100,90,120,100,80,80,80,75,100,100,100,100,80,120,120,90,120,120,80,80,80,90,80,90,90,90,100,100,100,100,100,100',".
			"RenderColumnIds='Online_RadiusUser_Id,RUsername,LastDownloadSpeed,LastUploadSpeed,ServiceInfoName,ServiceRate,VispName,NasName,CenterName,Name,Family,ISFinishUser,CallingStationId,CalledStationId,FramedIpAddress,NasIpAddress,SRCNasIpAddress,AcctStartTime,DTRequest,AcctSessionTime,SendTr,ReceiveTr,NasPortId,NasPortType,ServiceType,FramedProtocol,URLReporting,InterimTime,InterimCount,TerminateCause,ReturnTr,InternetUse,IntranetUse,MessengerUse,FreeUse,SpecialUse'";
			DBInsert($sql);
		}
		else{
			$n=DBDelete("Delete from Hgrid_layout where ItemName='OnlineRadiusUser' and Reseller_Id in ($SubTreeResellerSet)");
			DSDebug(1,"'OnlineRadiusUser' grid layout of $n reseller deleted");
		}
	}	
}

function SetCRMUserGridLayout($Reseller_Id){
	DSDebug(1,"In function SetCRMUserGridLayout for Reseller_Id=$Reseller_Id");
	$RenderColumnIds=DBSelectAsString("Select RenderColumnIds from Hgrid_layout where Reseller_Id='$Reseller_Id' and ItemName='CRMUser'");
	if($RenderColumnIds=="")
		return;	
	$CurrentFieldsArray=explode(",",$RenderColumnIds);	
	
	DSDebug(1,DSPrintArray($CurrentFieldsArray));
	$PermissionArray=Array();
	$sql="Select PermitItemName,ISPermit from Hreseller_permit r join Hpermititem p on r.PermitItem_Id=p.PermitItem_Id where Reseller_Id='$Reseller_Id' and PermitItemName<>'CRM.User.List' and PermitItemName like 'CRM.User.%' order by p.PermitItem_Id asc";
	$n=CopyTableToArray($PermissionArray,$sql);
	
	for($i=0;$i<$n;++$i){
		$Field=end(explode(".",$PermissionArray[$i]['PermitItemName']));
		$ISPermit=$PermissionArray[$i]['ISPermit'];
		if($ISPermit=='Yes'){
			if(!in_array($Field,$CurrentFieldsArray)){
				DSDebug(2,"ISPermit='Yes' field='$Field'\t not exist in the list. Adding $Field to the end of list");
				array_push($CurrentFieldsArray,$Field);
			}
			else
				DSDebug(2,"ISPermit='Yes' field='$Field'\t already exists in the list. Do nothing...");
		}
		else{
			if(($key = array_search($Field, $CurrentFieldsArray)) !== false){
				DSDebug(2,"ISPermit='No' field='$Field'\t found in the list as $key. Removing it from the list");
				unset($CurrentFieldsArray[$key]);
			}
			else
				DSDebug(2,"ISPermit='No' field='$Field'\t already not exists in the list. Do nothing...");
		}
	}
	
	$GridLayoutArray=Array(
		"User_Id"			=>	Array(	"u.User_Id",		"{#stat_count} rows",	"80"	),
		"Username"			=>	Array(	"u.Username",		"Username",				"100"	),
		"UserType"			=>	Array(	"UserType",			"UserType",				"60"	),
		"PortStatus"		=>	Array( 	"PortStatus",		"PortStatus",			"90"	),
		"Name"				=>	Array(	"u.Name",			"Name",					"100"	),
		"Family"			=>	Array(	"u.Family",			"Family",				"150"	),
		"NationalCode"		=>	Array(	"u.NationalCode",	"NationalCode",			"100"	),
		"Mobile"			=>	Array(	"u.Mobile",			"Mobile",				"100"	),
		"Phone"				=>	Array(	"u.Phone",			"Phone",				"100"	),
		"Organization"		=>	Array(	"Organization",		"Organization",			"150"	),
		"PayBalance"		=>	Array(	"u.PayBalance",		"PayBalance",			"80"	),
		"EndDate"			=>	Array(	"EndDate",			"EndDate",				"80"	),
		"ExpirationDate"	=>	Array(	"u.ExpirationDate",	"ExpireDate",			"80"	),		
		"BirthDate"			=>	Array(	"u.BirthDate",		"BirthDate",			"80"	),		
		"Note"				=>	Array(	"Note",				"Note",					"300"	),
		"ResellerName"		=>	Array(	"r.ResellerName",	"ResellerName",			"100"	),
		"StatusDT"			=>	Array(	"StatusDT",			"StatusDT",				"120"	),
		"StatusName"		=>	Array(	"StatusName",		"StatusName",			"300"	),
		"StatusCreator"		=>	Array(	"sbr.ResellerName",	"StatusCreator",		"90"	),
		"Comment"			=>	Array(	"u.Comment",		"Comment",				"160"	),		
		"Address"			=>	Array(	"u.Address",		"Address",				"300"	),
		"VispName"			=>	Array(	"VispName",			"VispName",				"110"	),
		"CenterName"		=>	Array(	"CenterName",		"CenterName",			"110"	),
		"SupporterName"		=>	Array(	"SupporterName",	"SupporterName",		"110"	),
		"ServiceName"		=>	Array(	"ServiceName",		"ServiceName",			"300"	)	
	);
	DSDebug(1,DSPrintArray($CurrentFieldsArray));
	$ColIds='';
	$ColHeaders='';
	$ColInitWidths='';
	$RenderColumnIds='';
	foreach($CurrentFieldsArray as $key=>$value){
		DSDebug(1,"key  =  $key	=>	value  =  $value");
		$ColIds.=",".$GridLayoutArray[$value][0];
		$ColHeaders.=",".$GridLayoutArray[$value][1];
		$ColInitWidths.=",".$GridLayoutArray[$value][2];
		$RenderColumnIds.=",".$value;
	}
	$ColIds=substr($ColIds,1);
	$ColHeaders=substr($ColHeaders,1);
	$ColInitWidths=substr($ColInitWidths,1);
	$RenderColumnIds=substr($RenderColumnIds,1);
	$sql="Update Hgrid_layout set ".
		"ColIds='$ColIds',".
		"ColHeaders='$ColHeaders',".
		"ColInitWidths='$ColInitWidths',".
		"RenderColumnIds='$RenderColumnIds' ".
		"where Reseller_Id='$Reseller_Id' and ItemName='CRMUser'";
	DBUpdate($sql);
}

?>
